<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Google Login Popup Example</title>
    <!-- Use your own CSP meta tag as needed -->
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' https://apis.google.com/ https://accounts.google.com/ https://www.gstatic.com;">
    <meta http-equiv="Cross-Origin-Opener-Policy" content="allow-popups" />
    <meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp" />
  </head>
  <body>
    <button id="loginButton">Login with Google</button>
    <div id="result"></div>

    <script>
      // When the login button is clicked, open the popup window.
      document.getElementById("loginButton").addEventListener("click", function () {
        const popup = window.open(
          "popup.html",
          "googleLogin",
          "width=500,height=600"
        );
        if (!popup) {
          alert("Popup blocked. Please allow popups for this site.");
        }
      });

      // Listen for the message from the popup containing the login response.
      window.addEventListener("message", function (event) {
        // Optionally, check event.origin here to validate the sender.
        const response = event.data;
        if (response && response.credential) {
          // Process the credential here.
          document.getElementById("result").innerText =
            "Received token: " + response.credential;
          console.log("Google login response:", response);
        }
      });
    </script>
  </body>
</html>